# *** Common configuration for interactive shells (shared by bash/zsh) ***

# LANGUAGE SUPPORT ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# *** NVM (Node Version Manager) ***
# https://github.com/creationix/nvm

# Set path to NVM and initialize. Requres fix for symlink into .dotfiles
# From CristianCantoro, 2018, https://github.com/creationix/nvm/issues/617
export NVM_DIR="$(realpath $HOME/.nvm)" 
[[ -s "$NVM_DIR/nvm.sh" ]] && . "$NVM_DIR/nvm.sh"  # This loads nvm
[[ -r "$NVM_DIR/bash_completion" ]] && \. "$NVM_DIR/bash_completion"


# *** Yarn (Node Dependency Manager) ***
# https://yarnpkg.com

# Set path to yarn
[[ -d "$HOME/.yarn/bin" ]] && export PATH="$HOME/.yarn/bin:$PATH"


# *** Ruby ***

# Add RVM to PATH for scripting. Make sure this is the last PATH variable change.
[[ -d "$HOME/.rvm/bin" ]] && export PATH="$PATH:$HOME/.rvm/bin"

# Load RVM into a shell session *as a function*
[[ -s "$HOME/.rvm/scripts/rvm" ]] && source "$HOME/.rvm/scripts/rvm"


# INTERACTIVE SHELL CONFIG ::::::::::::::::::::::::::::::::::::::::::::::::::::

# EXIT if not running interactively.
[[ $- != *i* ]] && return


# *** Options ***

export EDITOR='vim'

# Don't store commands in history file if they start with a space
# NOTE: Pressing up in current terminal session may still show most recent command
HISTCONTROL=ignoreboth # bash
[[ `type setopt 2>/dev/null` == *'builtin'* ]] && setopt histignorespace #zsh

# Make Ctrl-s and Ctrl-q available for mappings
# Prevents default behavior where they suspend and resume terminal client
stty -ixon
# Alternately, remap to different keys as below
# stty stop ''
# stty start ''

# Change paths without using 'cd' command
[[ `type shopt` == *'builtin'* ]] && shopt -s autocd # bash
[[ `type setopt 2>/dev/null` == *'builtin'* ]] && setopt autocd  # zsh

# Increase terminal colors.
[[ -n "$DISPLAY" && "$TERM" = "xterm" ]] && export TERM=xterm-256color


# *** Liquid Prompt ***
# https://github.com/nojhan/liquidprompt

[[ -r ~/liquidprompt/liquidprompt ]] && source ~/liquidprompt/liquidprompt


# *** Tmux ***
# https://wiki.archlinux.org/index.php/Tmux

# Attach to existing deattached session or start a new session.
if [[ `command -v tmux` && -z "$TMUX" ]] ;then
    ID="`tmux ls | grep -vm1 attached | cut -d: -f1`" # get id of deattached session
    if [[ -z "$ID" ]] ;then # if not available create a new one
        tmux new-session
    else
        tmux attach-session -t "$ID" # if available attach to it
    fi
fi


# *** Pager ***

# Override default pager
# [[ -x "$HOME/bin/pager" ]] && export PAGER="$HOME/bin/pager"
# alias less="$PAGER"


# *** Functions ***

# Source support functions
[[ -r ~/.functions ]] && . ~/.functions


# *** Aliases ***

# Source command aliases
[[ -r ~/.aliases ]] && . ~/.aliases


# EXTENDED CONFIGURATION ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# Source personal profile, if present.
[[ -r ~/personal/.shrc ]] && . ~/personal/.shrc

# Source work profile, if present.
[[ -r ~/business/.shrc ]] && . ~/business/.shrc


